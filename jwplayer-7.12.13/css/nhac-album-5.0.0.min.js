

/*!  * Nhac Web plugin for JW7 v5.0.0 support Cover, Lyric, Next  * Copyright 2015-2018 Nhac.vn, Vega Corp  * http://nhac.vn - 2018-12-04  */ (function(V){V().registerPlugin("nhac","6.0",function(e,G,H){function V(){var a=I.getElementsByClassName("jw-icon-playback")[0];void 0!=a&&(void 0==O&&(O=document.createElement("div"),O.className="jw-icon jw-icon-inline jw-button-color jw-reset jw-icon-back-song",O.onclick=function(){var a=e.getPlaylist(),b=e.getPlaylistIndex();0==b?e.playlistItem(a.length-1):e.playlistItem(b-1)},a.parentNode.insertBefore(O,a)),void 0==P&&(P=document.createElement("div"),P.className="jw-icon jw-icon-inline jw-button-color jw-reset jw-icon-next-song", P.onclick=function(){var a=e.getPlaylist();B.length>=a.length&&(B.length=0);if(Q){var b=e.getPlaylistIndex();x=b==a.length-1?0:b+1}else{do x=Math.floor(Math.random()*a.length);while(-1<B.indexOf(x))}0>B.indexOf(x)&&B.push(x);e.playlistItem(x)},a.parentNode.insertBefore(P,a.nextSibling)));a=I.getElementsByClassName("jw-icon-next-song")[0];void 0!=a&&(void 0==C&&(C=document.createElement("div"),C.className="jw-icon jw-icon-inline jw-button-color jw-reset jw-icon-repeat-none",C.onclick=function(){"jw-icon jw-icon-inline jw-button-color jw-reset jw-icon-repeat-none"== C.className?(C.className="jw-icon jw-icon-inline jw-button-color jw-reset jw-icon-repeat-all",R=!1,e.setConfig({repeat:!0})):"jw-icon jw-icon-inline jw-button-color jw-reset jw-icon-repeat-all"==C.className?(C.className="jw-icon jw-icon-inline jw-button-color jw-reset jw-icon-repeat-one",R=!0,e.setConfig({repeat:!0})):(C.className="jw-icon jw-icon-inline jw-button-color jw-reset jw-icon-repeat-none",R=!1,e.setConfig({repeat:!1}))},a.parentNode.insertBefore(C,a.nextSibling)),a=I.getElementsByClassName("jw-icon-back-song")[0], void 0==D&&(D=document.createElement("div"),D.className="jw-icon jw-icon-inline jw-button-color jw-reset jw-icon-sequence",D.onclick=function(){"jw-icon jw-icon-inline jw-button-color jw-reset jw-icon-sequence"==D.className?(D.className="jw-icon jw-icon-inline jw-button-color jw-reset jw-icon-shuffle",Q=!1):(D.className="jw-icon jw-icon-inline jw-button-color jw-reset jw-icon-sequence",Q=!0)},a.parentNode.insertBefore(D,a),a=document.createElement("div"),a.className="jw-icon jw-icon-inline jw-button-color jw-reset jw-icon-space", D.parentNode.insertBefore(a,D)))}function ha(){void 0==z&&void 0!=I.getElementsByClassName("jw-icon-hd")[0]&&(z=document.createElement("div"),z.className="jw-icon jw-icon-inline jw-button-color jw-reset jw-icon-lyric",z.onclick=function(){"jw-icon jw-icon-inline jw-button-color jw-reset jw-icon-lyric"==z.className?(z.className="jw-icon jw-icon-inline jw-button-color jw-reset jw-icon-lyric jw-toggle jw-off",r.style.visibility="hidden"):(z.className="jw-icon jw-icon-inline jw-button-color jw-reset jw-icon-lyric", r.style.visibility="visible")})}function T(a){if(!N)if(null!=e.getConfig().captionsTrack&&0<e.getConfig().captionsTrack.cues.length){N=!0;a=e.getConfig().captionsTrack.cues;var c=!1;if(2<a.length){var b=a[0].text,q=a[1].text.toLowerCase();if(0<=q.indexOf("s\u00e1ng t\u00e1c")||0<=q.indexOf("ca s\u0129")||0<=q.indexOf("tr\u00ecnh b\u00e0y")||0<=q.indexOf("th\u1ec3 hi\u1ec7n")||0<=q.indexOf("nh\u1ea1c s\u0129"))c=!0,a[0].startTime=0;0<=b.indexOf("B\u00e0i h\u00e1t: ")&&53<b.length&&(a[0].text=a[0].text.replace("B\u00e0i h\u00e1t: ", ""),a[1].text=a[1].text.replace("Ca s\u0129: ",""),a[1].text=a[1].text.replace("Nh\u1ea1c s\u0129: ",""))}if(G.resounded)for(b=1;b<a.length+1;b++){q=a[b-1].text;var d=(q.match(/([\s]+)/g)||[]).length+1,n=a[b-1].endTime-a[b-1].startTime,f=n/d,g=0,m="|";b<a.length&&(g=a[b].startTime-a[b-1].endTime);if(3>=b&&G.lyric_debug||0<=q.toLowerCase().indexOf("nhac.vn"))10>b?10>n?console.log("@@@ ",b,n.toFixed(2),"/",d,"=",f.toFixed(4),"|",g.toFixed(2),m,q):console.log("@@@ ",b,n.toFixed(1),"/",d,"=",f.toFixed(4), "|",g.toFixed(2),m,q):console.log("@@@",b,n.toFixed(2),"/",d,"=",f.toFixed(4),"|",g.toFixed(2),m,q);if(3<b&&0>q.toLowerCase().indexOf("nhac.vn")){var l=a[b-1].startTime-a[b-2].endTime,h=a[b-2].startTime-a[b-3].endTime,t=(a[b-2].text.match(/([\s]+)/g)||[]).length+1,w=a[b-2].endTime-a[b-2].startTime,p=w/t,u=n-p*d,y=0;if(1<=u||.9<g)m="$";G.lyric_debug&&(10>b?10>n?console.log("@@@ ",b,n.toFixed(2),"/",d,"=",f.toFixed(4),"|",g.toFixed(2),m,q,"/",u.toFixed(3)):console.log("@@@ ",b,n.toFixed(1),"/",d,"=", f.toFixed(4),"|",g.toFixed(2),m,q,"/",u.toFixed(3)):console.log("@@@",b,n.toFixed(2),"/",d,"=",f.toFixed(4),"|",g.toFixed(2),m,q,"/",u.toFixed(3)));2.5<u||.8<u&&1.199<=g&&.9899<=f?y=5:2<u||1.2<u&&1<f||1.1<g&&.9<f?y=4:1.5<u||1.1<u&&.7<f||1<g&&1.2<u?y=3:1.8<g&&.7<f||3.1<g&&.44<f&&0==l&&0==h||3.2<g&&.6<f&&0==l||10<g&&.5<f&&.1>l&&.1>h||20<g&&.48<f&&.2>l&&.2>h?y=4.9<g&&.7<f&&0==l?4:3:2.09<g&&.59<f||2.2<g&&.6<f||1.68<g&&.72<f||1.69<g&&.6<f&&.2>l||1.1<g&&.4<f&&.1>l||.5<g&&.7<f&&.1>l?y=.7<u?3:2:1.1<u||1< u&&.58<f||2<=g&&.8<f?y=2:1<u||2<=g&&.49<f?y=1:.5<u&&.79<f&&(G.lyric_debug&&(console.log("---",n.toFixed(3),"/",d,"=",f.toFixed(3),"|",g.toFixed(2)),console.log("---",w.toFixed(3),"/",t,"=",p.toFixed(3)),console.log("---",p.toFixed(3),"*",d,"=",(p*d).toFixed(3),"/",n.toFixed(3),"-",(p*d).toFixed(3),"=",u.toFixed(3))),y=1);5==y?(q=q.substr(q.length-1),a[b-1].text+=q+q+"...."):4==y?a[b-1].text+="....":3==y?a[b-1].text+="...":2==y?a[b-1].text+="..":1==y&&(a[b-1].text+=",");G.lyric_debug&&0<y&&console.log(" ->", a[b-1].text,f,"|",g,y)}}v=-1;k=[{startTime:0,text:""}];b=a[0].startTime;!c&&""!=ia&&2<b&&(c={},4<b?(c.text=ba,c.startTime=0,c.endTime=a[0].startTime/2-.5,k.push(c),k.push({startTime:a[0].startTime/2,text:""}),c={},c.text="Ca s\u0129: "+ca,c.startTime=a[0].startTime/2,c.endTime=a[0].startTime-.5,k.push(c)):(c.text=ba+" - "+ca,c.startTime=0,c.endTime=a[0].startTime-.5,k.push(c)),k.push({startTime:a[0].startTime,text:""}));for(b=0;b<a.length;b++)k.push(a[b]),k.push({startTime:a[b].endTime,text:""}), G.resounded&&b<a.length-1&&(n=a[b+1].startTime-a[b].endTime,10<n&&(c={},30<n?(c.text="5 4 3 2 1",c.startTime=a[b+1].startTime-2):20<n?(c.text="4 3 2 1",c.startTime=a[b+1].startTime-1.5):(c.text="3 2 1",c.startTime=a[b+1].startTime-1),c.endTime=a[b+1].startTime-.5,k.push(c),k.push({startTime:a[b+1].startTime,text:""})));W();ha();void 0!==z&&null!=e.getConfig().captionsTrack&&(X="visible",r.style.visibility="visible",z.className="jw-icon jw-icon-inline jw-button-color jw-reset jw-icon-lyric")}else Y(a)} function ja(a){T("firstFrame2")}function ka(a){if(void 0==E){a=I.getElementsByClassName("jw-icon-hd")[0];if(void 0==a)return;E=a.getElementsByClassName("jw-option")}1==E.length&&(a=E[0],"128K"==a.innerHTML?da("320K (Login)",320):"128 kbps"==a.innerHTML&&da("320 kbps (Login)",320));T("firstFrame")}function da(a,c){var b=document.createElement("li");b.className="jw-text jw-option jw-item-1 jw-reset";b.innerHTML=a;b.onclick=function(){Z=!0;"function"===typeof onPlayerLoginVip&&onPlayerLoginVip(c)};var e= E[E.length-1];e.parentNode.insertBefore(b,e.nextSibling)}function ea(a){var c=e.getCurrentQuality(),b=I.getElementsByClassName("jw-icon-hd")[0];void 0!=b&&(A=b.className,0<A.indexOf("jw-icon-hd-128")&&(A=A.substring(0,A.indexOf("jw-icon-hd-128")-1)),0<A.indexOf("jw-icon-hd-320")&&(A=A.substring(0,A.indexOf("jw-icon-hd-320")-1)),a=a[c].label.toLowerCase(),"320k"==a?b.className=A+" jw-icon-hd-320":"128k"==a&&(b.className=A+" jw-icon-hd-128"))}function Y(a){a=e.getConfig().playlistItem.tracks;void 0!= a&&0<a.length&&void 0!=a[0].file&&0==e.getCurrentCaptions()&&e.setCurrentCaptions(1)}function la(){if("visible"===X){var a=r.clientWidth,c=Math.pow(a/420,.6);h.style.maxWidth=a+"px";h.style.fontSize="18px";h.style.lineHeight="25px";h.style.position="relative";t.style.maxWidth=a+"px";t.style.fontSize="18px";t.style.lineHeight="25px";t.style.position="relative";t.style.display="inline-block";t.style.margin="0px";t.style.padding="0px";w.style.maxWidth=a+"px";w.style.fontSize="18px";w.style.lineHeight= "25px";w.style.position="relative";w.style.display="inline-block";w.style.margin="14px 0";m.style.color="#21b685";m.style.position="absolute";m.style.top="0px";m.style.left="0px";m.style.overflow="hidden";m.style.whiteSpace="nowrap";m.style.lineHeight="25px";l.style.color="#21b685";l.style.position="absolute";l.style.top="0px";l.style.left="0px";l.style.overflow="hidden";l.style.whiteSpace="nowrap";l.style.lineHeight="25px";d.windowOpacity&&(J.style.padding=Math.round(5*c)+"px",J.style.borderRadius= Math.round(5*c)+"px")}}function fa(a,c,b){if(!(K&&3<L)){var d=a.text,h=c.text;c=/<br\s*[\/]?>/gi;var n=!1;d=(d||"").replace(c," ");h=h.replace(c," ");if(""!==d&&""!==h){if(b){d!=m.innerHTML&&(m.style.width="0%",m.innerHTML=d,t.innerHTML=d);if(K||!n&&(""===l.innerHTML||M))n=!0,K&&(K=!1),l.style.width="0%",l.innerHTML=h,w.innerHTML=h;t.appendChild(m)}else M&&(m.innerHTML=h,t.innerHTML=h,l.innerHTML=d,w.innerHTML=d),w.appendChild(l);if(d.length){setTimeout(la,16);var f=1,g=0;var p=Math.round(1E3*(a.endTime- a.startTime)/50);M&&(f=(L-a.startTime)*p/(a.endTime-a.startTime));var r=setInterval(function(){if("paused"!=e.getState())if(g=f/p*100,100<g&&(g=100),L<a.startTime||Math.floor(L)>Math.ceil(a.endTime)||!N)clearInterval(r),v>=k.length-1&&(m.style.width="100%",l.style.width="100%",t.appendChild(m),w.appendChild(l));else if(b?(!n&&f>p/3&&v<k.length-2&&(n=!0,l.style.width="0%",l.innerHTML=h,w.innerHTML=h),53>=m.innerHTML.length&&(m.style.width=g+"%")):(!n&&f>p/3&&v<k.length-2&&(n=!0,m.style.width="0%", m.innerHTML=h,t.innerHTML=h),53>=l.innerHTML.length&&(l.style.width=g+"%")),f++,f>=p+1||M)clearInterval(r),b?v<k.length-1&&(l.style.width="0%"):v<k.length-1&&(m.style.width="0%")},50)}}}}function W(){for(var a=-1,c=0;c<k.length;c++)if(k[c].startTime<=L&&(c===k.length-1||k[c+1].startTime>=L)){a=c;break}if(-1===a)fa("");else if(a!==v){v=a;c=!0;0==(a+1)/2%2&&(c=!1);var b=v<k.length-2?k[a+2]:k[a-2];M&&""===k[a].text&&""===b.text&&(v=a=a<k.length-1?a+1:a-1,c=0==(a+1)/2%2?!1:!0,b=v<k.length-2?k[a+2]:k[a- 2]);fa(k[a],b,c)}}function aa(a){a=String(a).replace("#","");3===a.length&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]);return"#"+a.substr(-6)}function U(a,c){var b="rgb",d=[parseInt(a.substr(1,2),16),parseInt(a.substr(3,2),16),parseInt(a.substr(5,2),16)];void 0!==c&&100!==c&&(b+="a",d.push(c/100));return b+"("+d.join(",")+")"}"undefined"!==typeof GoPerformance&&"function"===typeof GoPerformance&&GoPerformance(e,G,H);var P,O,z,C,D,I,E,d,k,p,F,r,J,h,t,m,w,l,v,X="visible",M=!1,S=-1,R=!1,Q=!0,x=-1,B=[0],Z=!1,N= !1,K=!1,ia,ba,ca,A;e.onReady(function(a){I=e.getContainer();H.style.position="absolute";H.style.top="0px";H.style.width="100%";H.style.height="100%";H.style.overflow="hidden";H.style.pointerEvents="none";Y("onReady")});e.onBeforePlay(function(a){a=I.getElementsByClassName("jw-title")[0];if(void 0!=a){var c=e.getConfig().playlistItem.tracks;a.className=void 0==c||0==c.length||void 0==c[0].file?"jw-title jw-title-big jw-reset":"jw-title jw-reset"}a=e.getConfig().playlistItem.thumb;void 0!=a?F.src=a: void 0!=e.getConfig().playlistItem.image&&(F.src=e.getConfig().playlistItem.image)});e.on("meta",function(a){V();T("onMeta")});e.on("levels",function(a){ea(a.levels)});e.on("visualQuality",function(a){void 0==E&&(E=I.getElementsByClassName("jw-icon-hd")[0].getElementsByClassName("jw-option"));"auto"!=a.mode&&"auto"!=a.reason||e.setCurrentQuality(a.level.index);0<E.length&&(a=E[0],"Auto"==a.innerHTML&&(a.className="jw-hidden"))});e.on("beforeComplete",function(a){if(R)S=e.getPlaylistIndex();else if(!Q){a= e.getPlaylist();B.length>=a.length&&(B.length=0);do x=Math.floor(Math.random()*a.length);while(-1<B.indexOf(x));0>B.indexOf(x)&&B.push(x);S=x}});e.on("playlistItem",function(a){N=!1;K=!0;m.innerHTML="";t.innerHTML="";l.innerHTML="";w.innerHTML="";(R||!Q)&&0<=S&&(a=S,S=-1,e.playlistItem(a));X="hidden";r.style.visibility="hidden";void 0!==z&&(z.className="jw-icon jw-icon-inline jw-button-color jw-reset jw-icon-lyric jw-toggle jw-reset jw-hidden");Y("playlistItem")});if(void 0===G.showVIP||!1===G.showVIP)e.on("firstFrame", ja);else e.on("firstFrame",ka);e.on("levelsChanged",function(a){ea(a.levels);Z&&(Z=!1,e.setCurrentQuality(0))});e.on("time",function(a){N&&(L=a.position,k&&W());N||(a=e.getConfig().playlistItem.tracks,void 0!=a&&0<a.length&&void 0!=a[0].file&&T("onTime"))});e.on("seek",function(a){M=!0;K&&1>a.position&&(K=!1);m.style.width="0%";l.style.width="0%"});e.on("seeked",function(a){M=!1});this.resize=function(a,c){};(function(){p=document.createElement("div");p.style.display="block";p.style.position="relative"; p.style.width="250px";p.style.height="250px";p.style.top="25px";p.style.left="25px";p.style.overflow="hidden";p.style.borderRadius="5px";p.style.boxShadow="2px 3.5px 7px 0 rgba(0, 0, 0, 0.5)";p.style.zIndex="1";H.appendChild(p);F=document.createElement("img");F.style.position="absolute";F.style.left="50%";F.style.top="50%";F.style.height="100%";F.style.width="auto";F.style.transform="translate(-50%,-50%)";p.appendChild(F);d=e.getCaptions();void 0==d.color&&(d.color="#FFFFFF");void 0==d.fontFamily&& (d.fontFamily="Averta, Roboto, Arial, sans-serif");d.fontOpacity=100;void 0==d.fontStyle&&(d.fontStyle="normal");void 0==d.fontWeight&&(d.fontWeight="normal");void 0==d.textDecoration&&(d.textDecoration="none");void 0==d.edgeStyle&&(d.edgeStyle="uniform");void 0==d.backgroundColor&&(d.backgroundColor="#000");void 0==d.windowColor&&(d.windowColor="#FFFFFF");d.fontSize=14;var a=d.fontOpacity,c=d.windowOpacity,b=d.edgeStyle,k=d.backgroundColor,x;a=U(aa(d.color),a);var n=d.fontFamily,f=d.fontStyle,g= d.fontWeight,z=d.textDecoration,v;c&&(x=U(aa(d.windowColor),c));c=U("#000000",20);"dropshadow"===b?v="0 2px 1px "+c:"raised"===b?v="0 0 5px "+c+", 0 1px 5px "+c+", 0 2px 5px "+c:"depressed"===b?v="0 -2px 1px "+c:"uniform"===b&&(v="-2px 0 1px "+c+",2px 0 1px "+c+",0 -2px 1px "+c+",0 2px 1px "+c+",-1px 1px 1px "+c+",1px 1px 1px "+c+",1px -1px 1px "+c+",1px 1px 1px "+c);d.back&&U(aa(k),d.backgroundOpacity);r=document.createElement("div");J=document.createElement("div");h=document.createElement("div"); t=document.createElement("p");m=document.createElement("span");w=document.createElement("p");l=document.createElement("span");h.appendChild(t);h.appendChild(document.createElement("br"));h.appendChild(w);r.style.display="block";r.style.height="auto";r.style.width="536px";r.style.marginLeft="290px";r.style.position="absolute";r.style.top="90px";r.style.textAlign="center";r.style.zIndex="1";J.style.display="inline-block";void 0!=x&&(J.style.backgroundColor=x);h.style.color=a;h.style.display="inline-block"; h.style.fontFamily=n;h.style.fontStyle=f;h.style.fontWeight=g;h.style.textAlign="center";h.style.textDecoration=z;h.style.wordWrap="break-word";h.style.textShadow=v;J.appendChild(h);r.appendChild(J);H.appendChild(r)})();var L=0;k&&W()})})(jwplayer);

